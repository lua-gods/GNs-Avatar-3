local Tween = require"lib.tween"
local GNUI = require("lib.GNUI.main")
local Theme = require"lib.GNUI.theme"

local Pages = require"lib.pages"
local Button = require"lib.GNUI.element.button"


local sidebarSize = 200
local vsep = 0.5


local page = Pages.newPage("pageEditor")
---@param screen GNUI.Box
page.INIT:register(function (screen)
   
   -->====================[ Sidebar ]====================<--
   local toolbar = GNUI.newBox(screen)
   :setAnchor(1,0,1,1)
   :setSize(16,-8)
   Theme.style(toolbar,"Background")
   
   local sidebar = GNUI.newBox(screen)
   :setAnchor(1,0,1,1)
   
   Theme.style(sidebar,"Background")
   local sidebarButton = Button.new(screen,"none")
   :setAnchor(1,0,1,1)
   
   local function updateSidebarSize()
      sidebar:setDimensions(-sidebarSize,0,0,0)
      sidebarButton:setDimensions(-4-sidebarSize,0,2-sidebarSize,0)
      toolbar:setPos(-sidebarSize-20,4)
   end
   ---@param event GNUI.InputEventMouseMotion
   sidebarButton.MOUSE_MOVED:register(function (event)
      if sidebarButton.isPressed then
         sidebarSize = math.clamp(sidebarSize - event.relative.x,1,1000)
         updateSidebarSize()
      end
   end)
   
   
   local closeButton = Button.new(toolbar)
   :setSize(16,16)
   :setPos(0,-16)
   :setAnchor(0,1)
   :setTextOffset(0,-1)
   :setText("x")
   closeButton.PRESSED:register(function ()
      Pages.returnPage()
   end)
   
   local verticalSeparator = Button.new(sidebar)
   
   local upperContent = GNUI.newBox(sidebar)
   :setDimensions(0,0,0,-8)
   Theme.style(upperContent,"Background")
   
   local lowerContent = GNUI.newBox(sidebar)
   :setDimensions(0,6,0,0)
   Theme.style(lowerContent,"Background")
   
   local function updateVerticalSeparator()
      verticalSeparator
      :setAnchor(0,vsep,1,vsep)
      :setDimensions(1,-6,-1,6)
      :setText("Outliner")
   end
   ---@param event GNUI.InputEventMouseMotion
   verticalSeparator.MOUSE_MOVED:register(function (event)
      if verticalSeparator.isPressed then
         vsep = math.clamp(vsep + event.relative.y / sidebar.Size.y,0,1)
         updateVerticalSeparator()
      end
      upperContent:setAnchor(0,0,1,vsep)
      lowerContent:setAnchor(0,vsep,1,1)
   end)
   
   updateVerticalSeparator()
   
   updateSidebarSize()
end)